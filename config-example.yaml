# SBVC (Super Batch Video Compressor) é…ç½®æ–‡ä»¶ç¤ºä¾‹
# å¤åˆ¶æ­¤æ–‡ä»¶ä¸º config.yaml å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹
# ä¼˜å…ˆçº§ï¼šå‘½ä»¤è¡Œå‚æ•° > é…ç½®æ–‡ä»¶ > ç¨‹åºé»˜è®¤å€¼

# ============================================================
# è·¯å¾„é…ç½®
# ============================================================
paths:
  input: "/path/to/input"   # è¾“å…¥ç›®å½•
  output: "/path/to/output" # è¾“å‡ºç›®å½•
  log: "/path/to/logs"      # æ—¥å¿—ç›®å½•

  # Windows è·¯å¾„ç¤ºä¾‹ï¼š
  # input: "D:/Videos/input"
  # output: "D:/Videos/output"
  # log: "D:/Videos/logs"

# ============================================================
# ç¼–ç é…ç½®
# ============================================================
encoding:
  codec: hevc              # è¾“å‡ºç¼–ç : hevc, avc, av1
  audio_bitrate: "128k"    # é»˜è®¤éŸ³é¢‘ç›®æ ‡ç ç‡ï¼ˆéœ€è¦è½¬ç æ—¶ç”Ÿæ•ˆï¼Œå¯å†™ "128k"/"1M"/bps æ•°å­—ï¼‰

  # ============================================================
  # éŸ³é¢‘/å­—å¹•é«˜çº§ç­–ç•¥ï¼ˆå¯é€‰ï¼‰
  # - ä¸é…ç½®æ—¶è¡Œä¸ºä¸æ—§ç‰ˆä¸€è‡´ï¼šä»…ä¿ç•™ç¬¬ä¸€éŸ³è½¨å¹¶è½¬ AAC@audio_bitrateï¼Œå­—å¹•ä¸¢å¼ƒ
  # - åªè¦å¯ç”¨ä»»ä¸€é«˜çº§é€‰é¡¹ï¼Œä¼šå¯¹æ¯ä¸ªæ–‡ä»¶é¢å¤–è¿è¡Œä¸€æ¬¡ ffprobeï¼ˆè½»å¾®å¢åŠ è€—æ—¶ï¼‰
  # ============================================================
  audio:
    enabled: true               # false=ä¸è¾“å‡ºéŸ³é¢‘ï¼ˆç­‰ä»·äº ffmpeg -anï¼‰
    target_codec: aac           # éŸ³é¢‘è½¬ç ç›®æ ‡ç¼–ç ï¼ˆä»…åœ¨è½¬ç æ—¶ä½¿ç”¨ï¼‰
    target_bitrate: null        # éŸ³é¢‘è½¬ç ç›®æ ‡ç ç‡ï¼›null=æ²¿ç”¨ audio_bitrate
    channels: keep              # å£°é“æ§åˆ¶ï¼škeep|stereo|mono|5.1
    sample_rate: keep           # é‡‡æ ·ç‡æ§åˆ¶ï¼škeep|44100|48000

    # copy ç­–ç•¥ï¼š
    # off:       æ€»æ˜¯è½¬ç åˆ° target_codec/target_bitrate
    # aac_only:  ä»…å½“æºéŸ³é¢‘ä¸º AAC ä¸”ç ç‡ä¸é«˜äºç›®æ ‡æ—¶ copy
    # smart:     æº codec åœ¨ç™½åå•ä¸”æ»¡è¶³ç ç‡æ¡ä»¶æ—¶ copyï¼ˆç ç‡æœªçŸ¥åˆ™è½¬ç ï¼‰
    # always:    åªè¦æº codec åœ¨ç™½åå•å°±å°è¯• copyï¼ˆå¤±è´¥ä¼šè‡ªåŠ¨å›é€€è½¬ç ï¼‰
    copy_policy: off
    copy_allow_codecs: ["aac", "mp3"]   # å…è®¸ copy çš„æºéŸ³é¢‘ç¼–ç ï¼ˆå»ºè®®ä¿æŒ MP4 å‹å¥½ç¼–ç ï¼‰
    copy_max_bitrate_ratio: 1.0        # æºç ç‡ <= ç›®æ ‡ç ç‡*ratio æ‰ copyï¼ˆ1.0=ä¸é«˜äºç›®æ ‡ï¼‰
    aac_adtstoasc: true                # copy AAC åˆ° MP4 æ—¶è‡ªåŠ¨åŠ  aac_adtstoasc bitstream filter

    tracks:
      keep: first               # éŸ³è½¨ä¿ç•™ï¼šfirst|all|language_prefer
      prefer_language: ["zho","chi","eng"]  # language_prefer æ—¶çš„è¯­è¨€ä¼˜å…ˆçº§
      drop_commentary: false    # true=ä¼˜å…ˆè·³è¿‡ commentary éŸ³è½¨

    # å¸¸è§ç”¨æ³•ç¤ºä¾‹ï¼š
    # 1) åªå‹è§†é¢‘ä¿çœŸéŸ³é¢‘ï¼šcopy_policy: always
    # 2) ä¿ç•™å…¨éƒ¨éŸ³è½¨ä½†å‹ç¼©ï¼štracks.keep: all + copy_policy: off
    # 3) å¤šè¯­è¨€ä¸­ä¼˜å…ˆè‹±æ–‡ä¸»è½¨ï¼štracks.keep: language_prefer + prefer_language: ["eng"]

  subtitles:
    keep: none                  # å­—å¹•ç­–ç•¥ï¼šnone|mov_text|copy
                                # mov_text=è½¬ MP4 å†…åµŒå­—å¹•ï¼›copy=å°è¯•åŸæ ·æ‹·è´ï¼ˆä¸å…¼å®¹ä¼šè‡ªåŠ¨å›é€€ä¸¢å¼ƒï¼‰
    languages: ["zho","eng"]    # ä»…ä¿ç•™è¿™äº›è¯­è¨€çš„å­—å¹•ï¼ˆç©ºæ•°ç»„=ä¿ç•™å…¨éƒ¨ï¼‰

  # ç ç‡è®¡ç®—è§„åˆ™ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ï¼š
  # 1. forced > 0: å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šç ç‡ï¼Œå¿½ç•¥å…¶ä»–è§„åˆ™
  # 2. ratio: ç›®æ ‡ç ç‡ = åŸå§‹ç ç‡ Ã— ratio
  # 3. max_by_resolution: æ ¹æ®åˆ†è¾¨ç‡é™åˆ¶æœ€å¤§ç ç‡
  # 4. min: æœ€å°ç ç‡ä¿æŠ¤ï¼Œé˜²æ­¢è¿‡åº¦å‹ç¼©
  bitrate:
    forced: 0              # å¼ºåˆ¶ç ç‡(bps)ï¼Œ0=è‡ªåŠ¨è®¡ç®—ï¼›>0 æ—¶ç›´æ¥ä½¿ç”¨æ­¤å€¼
    ratio: 0.5             # å‹ç¼©æ¯”ä¾‹ï¼ˆ0.3=é«˜å‹ç¼©ï¼Œ0.5=å¹³è¡¡ï¼Œ0.7=é«˜è´¨é‡ï¼‰
    min: 500000            # æœ€å°ç ç‡ä¿æŠ¤(bps)ï¼Œå»ºè®®ä¸ä½äº 500kbps
    max_by_resolution:     # åˆ†è¾¨ç‡è‡ªé€‚åº”ç ç‡å°é¡¶ï¼ˆä½¿ç”¨è§†é¢‘çŸ­è¾¹åˆ¤æ–­ï¼‰
      720: 1500000         # 720p: 1.5 Mbps
      1080: 3000000        # 1080p: 3 Mbps
      1440: 5000000        # 1440p (2K): 5 Mbps
      2160: 9000000        # 4K: 9 Mbps

# ============================================================
# æ—¥å¿—/æ§åˆ¶å°è¾“å‡º
# ============================================================
logging:
  level: INFO            # æ—¥å¿—çº§åˆ«: DEBUG/INFO/WARNING/ERROR
                         # DEBUG: æŸ¥çœ‹ç¡¬è§£å†³ç­–ã€å®Œæ•´ FFmpeg å‘½ä»¤
                         # INFO: é»˜è®¤çº§åˆ«ï¼Œæ˜¾ç¤ºä»»åŠ¡è¿›åº¦å’Œç»Ÿè®¡
  plain: false           # true=ç¦ç”¨å½©è‰²/è£…é¥°ï¼ˆé€‚åˆä¸æ”¯æŒ ANSI çš„ç»ˆç«¯ï¼‰
  json_console: false    # true=æ§åˆ¶å°è¾“å‡º JSON è¡Œï¼ˆä¾¿äºæ—¥å¿—é‡‡é›†/CIï¼‰
  show_progress: true    # æ˜¯å¦æ˜¾ç¤ºè¿›åº¦è¡Œï¼ˆå®æ—¶æ˜¾ç¤ºç¼–ç è¿›åº¦ï¼‰
  print_cmd: false       # æ€»æ˜¯æ‰“å°å®Œæ•´ FFmpeg å‘½ä»¤ï¼ˆè°ƒè¯•æ—¶å¯ç”¨ï¼‰

# ============================================================
# å¸§ç‡é™åˆ¶
# ============================================================
fps:
  max: 30                          # æœ€å¤§å¸§ç‡é™åˆ¶ï¼ˆè¶…è¿‡æ­¤å€¼çš„è§†é¢‘ä¼šé™å¸§ï¼‰
  limit_on_software_decode: true   # è½¯è§£æ—¶é™å¸§ï¼ˆå‡è½» CPU è´Ÿæ‹…ï¼‰
  limit_on_software_encode: true   # è½¯ç¼–æ—¶é™å¸§ï¼ˆCPU ç¼–ç æ—¶å¯ç”¨ï¼‰
                                   # æ³¨ï¼šç¡¬è§£+ç¡¬ç¼–æ—¶ä¸é™å¸§ï¼Œå¯å……åˆ†åˆ©ç”¨ç¡¬ä»¶æ€§èƒ½

# ============================================================
# ç¼–ç å™¨é…ç½®
# ============================================================
# ğŸ’¡ å·¥ä½œåŸç†ï¼š
#   - å„ç¼–ç å™¨çš„ enabled å­—æ®µè¡¨ç¤º"æƒ³ä½¿ç”¨"
#   - å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹ç¡¬ä»¶ï¼Œä¸å¯ç”¨çš„ä¼šè¢«è‡ªåŠ¨ç¦ç”¨
#   - å¯ç”¨çš„ç¡¬ä»¶ç¼–ç å™¨å¹¶å‘å¤„ç†ï¼ŒæŒ‰ä¼˜å…ˆçº§åˆ†é…ä»»åŠ¡
#   - å¤±è´¥ä»»åŠ¡è‡ªåŠ¨å›é€€ï¼šåŒç¼–ç å™¨é™çº§ â†’ å…¶ä»–ç¼–ç å™¨ â†’ CPUå…œåº•
#
# ğŸ’¡ ç¼–ç å™¨è¯´æ˜ï¼š
#   - nvenc: NVIDIA GPU (éœ€è¦ N å¡ + é©±åŠ¨)
#   - qsv: Intel Quick Sync (éœ€è¦ Intel é›†æ˜¾ + é©±åŠ¨)
#   - videotoolbox: Apple ç¡¬ä»¶ç¼–ç  (ä»… macOS)
#   - cpu: è½¯ä»¶ç¼–ç å…œåº• (æœ€æ…¢ä½†å…¼å®¹æ€§æœ€å¥½)
#
# ğŸ’¡ ä¼˜å…ˆçº§é¡ºåº: nvenc > videotoolbox > qsv > cpu

encoders:
  # NVIDIA NVENC
  nvenc:
    enabled: true          # æƒ³ç”¨å°±è®¾ trueï¼Œå¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹æ˜¯å¦å¯ç”¨
    max_concurrent: 3      # å¹¶å‘ä¸Šé™

  # Intel QSV
  qsv:
    enabled: true          # æƒ³ç”¨å°±è®¾ trueï¼Œå¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹æ˜¯å¦å¯ç”¨
    max_concurrent: 2

  # Apple VideoToolbox (ä»… macOS)
  videotoolbox:
    enabled: false         # macOS ç”¨æˆ·è®¾ true
    max_concurrent: 3

  # CPU è½¯ä»¶ç¼–ç  (å…œåº•)
  cpu:
    enabled: true          # å»ºè®®ä¿æŒ true ä½œä¸ºæœ€ç»ˆå…œåº•
    max_concurrent: 4
    preset: medium         # ultrafast/fast/medium/slow

# ============================================================
# è°ƒåº¦é…ç½®
# ============================================================
scheduler:
  # æ€»å¹¶å‘ä¸Šé™ (å»ºè®® = å„ç¼–ç å™¨ max_concurrent ä¹‹å’Œ)
  max_total_concurrent: 5

# ============================================================
# æ–‡ä»¶å¤„ç†
# ============================================================
files:
  min_size_mb: 100         # æœ€å°æ–‡ä»¶å¤§å°é˜ˆå€¼ï¼ˆMBï¼‰ï¼Œå°äºæ­¤å€¼çš„æ–‡ä»¶ä¼šè¢«è·³è¿‡
  keep_structure: true     # ä¿æŒè¾“å…¥ç›®å½•ç»“æ„ï¼ˆfalse=æ‰å¹³åŒ–è¾“å‡ºï¼‰
  skip_existing: true      # è·³è¿‡å·²å­˜åœ¨çš„è¾“å‡ºæ–‡ä»¶ï¼ˆé¿å…é‡å¤å¤„ç†ï¼‰

# ============================================================
# å¸¸è§åœºæ™¯é…ç½®ç¤ºä¾‹
# ============================================================
#
# ã€Windows: Nå¡ + Intelé›†æ˜¾ã€‘(æ¨èé…ç½®)
# é€‚ç”¨äºåŒæ—¶æ‹¥æœ‰ NVIDIA æ˜¾å¡å’Œ Intel CPU çš„å°å¼æœº/ç¬”è®°æœ¬
# encoders:
#   nvenc: { enabled: true, max_concurrent: 3 }
#   qsv: { enabled: true, max_concurrent: 2 }
#   cpu: { enabled: true }
# scheduler: { max_total_concurrent: 5 }
#
# ã€Windows: ä»… N å¡ã€‘
# é€‚ç”¨äºä»…æœ‰ NVIDIA æ˜¾å¡çš„ç³»ç»Ÿï¼ˆAMD CPU æˆ– Intel æ ¸æ˜¾ä¸å¯ç”¨ï¼‰
# encoders:
#   nvenc: { enabled: true, max_concurrent: 3 }
#   qsv: { enabled: false }
#   cpu: { enabled: true }
# scheduler: { max_total_concurrent: 3 }
#
# ã€macOS: Apple èŠ¯ç‰‡ã€‘
# é€‚ç”¨äº M1/M2/M3 ç­‰ Apple Silicon èŠ¯ç‰‡çš„ Mac
# encoders:
#   nvenc: { enabled: false }
#   qsv: { enabled: false }
#   videotoolbox: { enabled: true, max_concurrent: 3 }
#   cpu: { enabled: true }
# scheduler: { max_total_concurrent: 3 }
#
# ã€çº¯ CPU æ¨¡å¼ã€‘(æ— ç¡¬ä»¶åŠ é€Ÿ)
# é€‚ç”¨äºæ²¡æœ‰ç¡¬ä»¶åŠ é€Ÿæˆ–æµ‹è¯•ç¯å¢ƒ
# encoders:
#   nvenc: { enabled: false }
#   qsv: { enabled: false }
#   videotoolbox: { enabled: false }
#   cpu: { enabled: true, max_concurrent: 4 }
# scheduler: { max_total_concurrent: 4 }
#
# ã€é«˜è´¨é‡æ¨¡å¼ã€‘
# é€‚ç”¨äºéœ€è¦ä¿ç•™æ›´å¤šè´¨é‡çš„åœºæ™¯
# encoding:
#   bitrate:
#     ratio: 0.7           # ä¿ç•™ 70% ç ç‡
#     max_by_resolution:
#       720: 2000000       # æé«˜å°é¡¶å€¼
#       1080: 5000000
#       1440: 8000000
#       2160: 15000000
#
# ã€æé™å‹ç¼©æ¨¡å¼ã€‘
# é€‚ç”¨äºéœ€è¦èŠ‚çœç©ºé—´çš„åœºæ™¯ï¼ˆè´¨é‡ä¼šä¸‹é™ï¼‰
# encoding:
#   bitrate:
#     ratio: 0.3           # åªä¿ç•™ 30% ç ç‡
#     max_by_resolution:
#       720: 1000000       # é™ä½å°é¡¶å€¼
#       1080: 2000000
#       1440: 3500000
#       2160: 6000000
